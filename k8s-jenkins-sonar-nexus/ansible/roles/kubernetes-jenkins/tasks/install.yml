- name: Deploying Persistent Volume (Claim) for Jenkins
  shell: |
    kubectl apply -f "{{ item }}"
  with_items:
  - "{{ JENKINS_FOLDER }}/persistent_volume.yml"
  - "{{ JENKINS_FOLDER }}/persistent_volume_claim.yml"

- name: Deploying jenkins
  shell: |
    kubectl apply -f "{{ item }}"
  with_items:
  - "{{ JENKINS_FOLDER }}/deployment.yml"
  - "{{ JENKINS_FOLDER }}/service.yml"

- name: Create Ingress
  shell: |
    kubectl apply -f "{{ JENKINS_FOLDER }}/ingress.yml"

- name: Create Service Account for Jenkins
  shell: |
    kubectl create clusterrolebinding jenkins --clusterrole cluster-admin --serviceaccount=jenkins:default
